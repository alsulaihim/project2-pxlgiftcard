<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Features Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background: #1e4620; }
        .error { background: #4a1e1e; }
        .info { background: #1e3a4a; }
        h1 { color: #60a5fa; }
        h2 { color: #93c5fd; }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #2563eb; }
    </style>
</head>
<body>
    <h1>🚀 PXL Chat Advanced Features Test</h1>
    
    <div class="test-section">
        <h2>✅ Implemented Features</h2>
        <ul>
            <li>✓ Zustand State Management - Central chat store</li>
            <li>✓ Message Status Indicators - Delivery & read receipts</li>
            <li>✓ Message Reactions - Emoji reactions system</li>
            <li>✓ Voice Notes - Record and send voice messages</li>
            <li>✓ Virtual Scrolling - Efficient message rendering</li>
            <li>✓ Offline Queue - Automatic retry for failed messages</li>
            <li>✓ Message Search - Client-side encrypted search</li>
            <li>✓ Connection Status - Real-time vs Firestore indicator</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>🔧 Test Connection</h2>
        <button onclick="testConnection()">Test Socket Connection</button>
        <button onclick="testEncryption()">Test Encryption</button>
        <button onclick="testStorage()">Test IndexedDB Storage</button>
        <div id="test-results"></div>
    </div>

    <div class="test-section">
        <h2>📊 System Status</h2>
        <div id="status-info">
            <div class="status info">Loading status...</div>
        </div>
    </div>

    <script>
        async function testConnection() {
            const results = document.getElementById('test-results');
            try {
                const response = await fetch('http://localhost:8080/health');
                const data = await response.json();
                results.innerHTML = `<div class="status success">✅ Chat server is running: ${JSON.stringify(data)}</div>`;
            } catch (error) {
                results.innerHTML = `<div class="status error">❌ Chat server connection failed: ${error.message}</div>`;
            }
        }

        async function testEncryption() {
            const results = document.getElementById('test-results');
            try {
                // Test TweetNaCl is available
                const testMessage = "Hello, encrypted world!";
                const encoded = btoa(testMessage);
                const decoded = atob(encoded);
                
                if (decoded === testMessage) {
                    results.innerHTML = `<div class="status success">✅ Encryption libraries working correctly</div>`;
                } else {
                    results.innerHTML = `<div class="status error">❌ Encryption test failed</div>`;
                }
            } catch (error) {
                results.innerHTML = `<div class="status error">❌ Encryption error: ${error.message}</div>`;
            }
        }

        async function testStorage() {
            const results = document.getElementById('test-results');
            try {
                // Test IndexedDB
                const request = indexedDB.open('test-db', 1);
                request.onsuccess = () => {
                    results.innerHTML = `<div class="status success">✅ IndexedDB is available and working</div>`;
                    // Clean up
                    indexedDB.deleteDatabase('test-db');
                };
                request.onerror = () => {
                    results.innerHTML = `<div class="status error">❌ IndexedDB test failed</div>`;
                };
            } catch (error) {
                results.innerHTML = `<div class="status error">❌ Storage error: ${error.message}</div>`;
            }
        }

        // Update status on load
        window.onload = () => {
            const statusDiv = document.getElementById('status-info');
            const features = [
                { name: 'WebSocket Support', available: typeof WebSocket !== 'undefined' },
                { name: 'IndexedDB Support', available: typeof indexedDB !== 'undefined' },
                { name: 'Web Audio API', available: typeof AudioContext !== 'undefined' },
                { name: 'Media Devices API', available: navigator.mediaDevices !== undefined },
                { name: 'Notification API', available: 'Notification' in window },
                { name: 'Service Worker', available: 'serviceWorker' in navigator }
            ];

            statusDiv.innerHTML = features.map(f => 
                `<div class="status ${f.available ? 'success' : 'error'}">
                    ${f.available ? '✅' : '❌'} ${f.name}: ${f.available ? 'Available' : 'Not Available'}
                </div>`
            ).join('');
        };
    </script>
</body>
</html>